<!DOCTYPE html>
<!--
 * Copyright 2011 Google Inc. All Rights Reserved.
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *    http://www.apache.org/licenses/LICENSE-2.0
 *  
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
-->
<html>
  <head>
    <title>DOM Snitch::Setup</title>
    <style>
      body {
        font-family: verdana;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
  <script>
    // Edit the following line if you want to provide config data through the
    // install script.
    var configData = undefined;
    
    // Edit the following line if you want to provide config data through a
    // config URL.
    var configUrl = undefined;

    // Setting up config data and extension URLs.
    var config = configData || configUrl;
    config = (configData ? "#data=" : "#url=") + config;

    var extId = "<ID for the extension>";
    var extRunning = false;
    var extCallback = function() {
      extRunning = true;
    };
    
    var checkIfInstalled = function() {
      document.getElementById("working").style.display = "none";
      
      if(extRunning) {
        document.getElementById("statusOk").style.display = "";
      } else {
        document.getElementById("statusFailed").style.display = "";
      }
    };

    var url = "chrome-extension://" + extId + "/ui/config/importConfig.html";
    
    
    // Probing if the extension is installed.
    window.addEventListener("message", extCallback, true);
    var initCheck = function() {
      var frame = document.getElementById("extFrame");
      frame.src = url + config;
    
      setTimeout(checkIfInstalled, 1000);
    }
    
    document.addEventListener("DOMContentLoaded", initCheck, true);
    
  </script>
  <div id="working">
    Checking if DOM Snitch is installed and enabled...
  </div>
  <div id="statusOk" style="display:none;">
    DOM Snitch is enabled and configured. You may safely close this window.
  </div>
  <div id="statusFailed" style="display:none;">
    DOM Snitch is not installed or enabled. Please complete the appropriate steps 
    and reload this page.
    <p>
      <b>To install DOM Snitch</b>
      <ol>
        <li>Go to <a href="https://code.google.com/p/domsnitch/downloads/list" target="_blank">https://code.google.com/p/domsnitch/downloads/list</a>.</li>
        <li>Click on the latest version and download.</li>
      </ol>
    </p>
    <p>
      <b>To enable</b>
      <ol>
        <li>Go to <a href="chrome://extensions" target="_blank">chrome://extensions</a>.</li>
        <li>Locate DOM Snitch and select "Enable".</li>
      </ol>
    </p>
  </div>
  <iframe id="extFrame" style="display:none;"></iframe>
  </body>
</html>